#!/bin/bash
clear
figlet $'\t\t\t\t\t\t\t\t\t\t\t\t'welcome
echo ""
echo $'\t\t\t'"CVE-ID GENERATOR"
echo ""
if [  ! -d totalcve/ ]
then
        mkdir totalcve/
fi
wget -q "https://nvd.nist.gov/vuln/search/results?adv_search=false&form_type=basic&results_type=overview&search_type=all" -O totalcve/all.cve
grep '"vuln-matching-records-count"' totalcve/all.cve | sed -e 's/<[^>]*>//g;s/^[ \t]*//g;s/[ A-Za-z.]*//g' > totalcve/cves.txt
totalcve=$(<totalcve/cves.txt)
echo $'\t'"TOTAL NUMBER OF CVES AVAILABLE:"$'\t\t'"$totalcve"
while true
do
PS3='Please Select Option: '
echo ""
options=("Latest CVEs" "CVE Search" "Remove CVE Files & Directories" "Quit")
select opt in "${options[@]}"
do
    case $opt in
        "Latest CVEs")
clear
if [  ! -d CVE/ ]
then
        mkdir CVE/
fi
echo "Searching Latest CVEs....."
MONTH=$(date -d "$D" '+%m')
YEAR=$(date -d "$D" '+%Y')
wget -q https://nvd.nist.gov/vuln/full-listing/"$YEAR"/"$MONTH" -O CVE/cvss
grep '"col-md-2"' CVE/cvss | sed -e 's/<[^>]*>//g;s/^[ \t]*//g' >> CVE/latestcvss.txt
tail -n 25 CVE/latestcvss.txt
echo ""
date +"Latest CVEs since - %e %B %Y"
            break
            ;;
        "CVE Search")
clear
echo "Please enter CVE-ID"
read cveid
if [  ! -d CVE/ ]
then
        mkdir CVE/
fi

if [  ! -d CVE/"$cveid" ]
then
        mkdir CVE/"$cveid"
fi
wget -q https://nvd.nist.gov/vuln/detail/"$cveid" -O CVE/"$cveid"/tmp.cve
wget -q http://www.cvedetails.com/cve/"$cveid" -O CVE/"$cveid"/tmp1.cve
grep '&vector=(' CVE/"$cveid"/tmp.cve | sed -e 's/^[ \t]*//g;s/<[^(]*//g;s/"[^>]*//g;2d' > CVE/"$cveid"/cv2.cve
grep '&vector=A' CVE/"$cveid"/tmp.cve | sed -e 's/^[ \t]*//g;s/<[^A]*//g;s/"[^>]*//g;2d' > CVE/"$cveid"/cv3.cve
cvv2=$(<CVE/"$cveid"/cv2.cve)
cvv3=$(<CVE/"$cveid"/cv3.cve)
phantomjs get.js "https://nvd.nist.gov/vuln-metrics/cvss/v2-calculator?name="$cveid"&vector="$cvv2"" > CVE/"$cveid"/"cvss2.html"
phantomjs get.js "https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?name="$cveid"&vector="$cvv3"" > CVE/"$cveid"/"cvss3.html"
clear
echo ______________________________________________________________ > CVE/"$cveid"/"$cveid"
echo CVE ID: "$cveid" >> CVE/"$cveid"/"$cveid"
echo ______________________________________________________________ >> CVE/"$cveid"/"$cveid"
echo CVE DESCRIPTION: >> CVE/"$cveid"/"$cveid"
grep '"vuln-description"' CVE/"$cveid"/tmp.cve | sed -e 's/<[^>]*>//g;s/^[ \t]*//g' >> CVE/"$cveid"/"$cveid"
echo ______________________________________________________________ >> CVE/"$cveid"/"$cveid"
echo CVSS v2 SCORE:$'\t\t'CVSS v2 SEVERITY: >> CVE/"$cveid"/"$cveid"
grep '"cvss-base-score-cell"' CVE/"$cveid"/cvss2.html | sed -e 's/<[^>]*>//g;s/^[ \t]*//g' > CVE/"$cveid"/CVSSV2.txt
grep '"vuln-cvssv2-base-score-severity"' CVE/"$cveid"/tmp.cve | sed -e 's/<[^>]*>//g;s/^[ \t]*//g' > CVE/"$cveid"/CVSSV2SE.txt
paste CVE/"$cveid"/CVSSV2.txt CVE/"$cveid"/CVSSV2SE.txt | awk -F'\t' '{ printf("%-23s %s\n", $1, $2) }' >> CVE/"$cveid"/"$cveid"
echo ______________________________________________________________ >> CVE/"$cveid"/"$cveid"
echo CVSS v3 SCORE:$'\t\t'CVSS v3 SEVERITY: >> CVE/"$cveid"/"$cveid"
grep '"cvss-base-score-cell"' CVE/"$cveid"/cvss3.html | sed -e 's/<[^>]*>//g;s/^[ \t]*//g' > CVE/"$cveid"/CVSSV3.txt
grep '"vuln-cvssv3-base-score-severity"' CVE/"$cveid"/tmp.cve | sed -e 's/<[^>]*>//g;s/^[ \t]*//g' > CVE/"$cveid"/CVSSV3SE.txt
paste CVE/"$cveid"/CVSSV3.txt CVE/"$cveid"/CVSSV3SE.txt | awk -F'\t' '{ printf("%-23s %s\n", $1, $2) }' >> CVE/"$cveid"/"$cveid"
echo ______________________________________________________________ >> CVE/"$cveid"/"$cveid"
echo VULNERABILITY TYPE: >> CVE/"$cveid"/"$cveid"
grep '"vuln-technical-details-0-link"' CVE/"$cveid"/tmp.cve | sed -e 's/<[^>]*>//g;s/^[ \t]*//g' >> CVE/"$cveid"/"$cveid"
echo ______________________________________________________________ >> CVE/"$cveid"/"$cveid"
echo VENDOR: >> CVE/"$cveid"/"$cveid"
grep 'Details for *' CVE/"$cveid"/tmp1.cve | sed -e 's/<[^>]*>//g;s/^[ \t]*//g' > CVE/"$cveid"/temp.txt
cat CVE/"$cveid"/temp.txt | sed 's/[ \t]*$//' > CVE/"$cveid"/temp1.txt
sort CVE/"$cveid"/temp1.txt | uniq > CVE/"$cveid"/VENDOR.txt
cat CVE/"$cveid"/VENDOR.txt >> CVE/"$cveid"/"$cveid"
echo ______________________________________________________________ >> CVE/"$cveid"/"$cveid"
echo ORIGINAL RELEASE DATE:$'\t\t'LAST REVISED: >> CVE/"$cveid"/"$cveid"
grep 'Date : *' CVE/"$cveid"/tmp1.cve | sed -e 's/<[^>]*>//g;s/^[ \t]*//g;s/P[^2]*//g;s/L[^2]*//g' | awk -F'\t' '{ printf("%-31s %s\n", $1, $2) }' >> CVE/"$cveid"/"$cveid"
echo ______________________________________________________________ >> CVE/"$cveid"/"$cveid"
echo "ADDITIONAL INFORMATION & REFERENCES:" >> CVE/"$cveid"/"$cveid"
grep 'vuln-hyperlinks-link-' CVE/"$cveid"/tmp.cve | sed -e 's/<[^>]*>//g;s/^[ \t]*//g' >> CVE/"$cveid"/"$cveid"
echo ______________________________________________________________ >> CVE/"$cveid"/"$cveid"
#rm -f CVE/"$cveid"/*.txt
#rm -f CVE/"$cveid"/*.cve
#rm -f CVE/"$cveid"/*.html
cat CVE/"$cveid"/"$cveid"
            break
            ;;
        "Remove CVE Files & Directories")
            clear
            rm -r CVE/
            rm -r totalcve/
            echo "CVE Files & Directories Deleted"
            break
            ;;
        "Quit")
            clear
            exit
            ;;
        *) echo invalid option;;
    esac
done
done
